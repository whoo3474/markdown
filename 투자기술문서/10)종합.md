
ㄴ이 개념들은 어떤것들을 하기위한 녀석인거다.

이 개념들을 가지고 어떤 것들을 대처해서 이런 기능을 써서 미니인턴을 구축했다.
트래픽이 늘거나 무슨 일이 있을때 
뭐 어떻게 하려고 한다.


그러면 실질적으로 세팅해놓은 것들.


이 기술로 무엇을 할수 있다.
어떤 시스템을 구축 하였다.




# 기술 적용 시나리오

1. 고가용성의 서버 구축
   가용성 ( 서비스 가용성이라고도 함)은 안정성을 정량적으로 측정하는 데 일반적으로 사용되는 지표입니다.

   가용성은 워크로드를 사용할 수 있는 시간의 비율입니다.

   사용할 수 있다 는 말은 필요할 때 적절한 기능을 수행한다는 것을 의미합니다.
   
   이 비율은 월, 연 또는 이후 3년과 같이 특정 기간에 걸쳐 계산됩니다. 가장 엄격한 해석을 적용할 때 가용성은 예정된 중단 및 예정되지 않은 중단을 포함하여 애플리케이션이 정상적으로 작동하지 않는 모든 시간에 감소합니다. 우리가 가용성 을 정의할 때 사용하는 기준은 다음과 같습니다.

    ![availability](https://docs.aws.amazon.com/ko_kr/wellarchitected/latest/reliability-pillar/images/availability-formula.png)

    - 일정 기간(대개 1년) 동안의 가동 시간 비율(예: 99.9%)
    - 흔히 사용되는 약어: “숫자 9의 수”(예: “5개의 9” = 가용성 99.999%)

    아래 표에는 일반적인 애플리케이션 가용성 설계 목표와 해당 목표를 충족하면서 1년 동안 허용되는 최대 중단 시간의 길이가 나와 있습니다. 이 표에는 각 가용성 계층에서 흔히 볼 수 있는 애플리케이션 유형의 예가 포함되어 있습니다.


    |가용성	|최대 사용 불가(연간)	|애플리케이션 범주|
    |----|-------------------|------------------------|
    |99%	|3일 15시간|	배치 처리, 데이터 추출, 전송 및 로드 작업|
    |99.9%	|8시간 45분|	지식 관리, 프로젝트 추적과 같은 내부 도구|
    |99.95%	|4시간 22분	|온라인 상거래, POS(Point of Sale)|
    |99.99%	|52분	|비디오 전송, 브로드캐스트 워크로드|
    |99.999%|	5분	|ATM 트랜잭션, 통신 워크로드|


   오픈놀은 가용성 99.99%를 목표로 다음과 같은 작업을 하고있습니다.
   - 리소스 모니터링
   - 서버에 부하 증가시 오토 스케일링(서버 자동 증설)
   - 배포시 블루/그린 배포
   - 에러시 이전 배포 버전으로 롤백
   - Kubernetes ETCD 백업
   - 가용 영역(데이터센터) 3개 사용

2. 장애 대응 알림, 모니터링 시스템 구축
   기존의 모니터링 시스템은 **htop** 을 이용하여, 현재의 CPU와 RAM의 사용량을 확인하고, 문제가 발생할시 **/var/log/nginx**의 **access.log**와 **error.log**를 직접 확인하는것이 전부였다.
   ![image](https://user-images.githubusercontent.com/23617635/150773221-43f3f19a-cb5d-4310-9060-d752b4b2adbe.png)

   이후의 Grafana와 Prometheus를 사용하며, 메트릭 정보들을 확인하고, 어떤 시간대에서 서버에 부하가 많은지 시각적으로 확인할수 있게되었다.
   ![images](https://www.percona.com/blog/wp-content/uploads/2016/10/Screen-Shot-2016-10-17-at-18.12.00.png)
   
   그럼으로써 좀더 장애 처리를 더 수월하게 할수있고, 사용자들이 몰리는 시간대와 아닌 시간대를 확인하여 적절한 리소스 분배가 가능하게 되었다.

3. 자동화 배포 환경 구축
   기존에는 Jenkins를 통해서 CI/CD를 구현을 하고 있었다.
   ![image](https://user-images.githubusercontent.com/23617635/150774053-2d786e4d-f87d-4a0f-86a7-4bf719890016.png)
   
    하지만, Kubernetes를 사용함으로써, GitOps의 중요성이 대두되었다.
    Github Actions와 ArgoCD를 도입한후, 사용자가 배포의 원하는 상태 (desired state)를 선언적으로 정의하여, 더 쉽게 배포하고, 문제 발생시, 롤백이 쉬워지게 되었다.
    또한, 장애 등으로 인한 손상된 배포 환경을 자가 치유하기에 유리해졌다.
    
   
   ![image](https://user-images.githubusercontent.com/23617635/150774686-cc529743-039e-4c34-90b9-f6c3c6217897.png)
   ![image](https://user-images.githubusercontent.com/23617635/150775715-eb57afdb-1462-4584-8429-1e2f7b0f135b.png)


4. 사내, 외적인 보안
   보안이라 함은, 네트워크 , 애플리케이션, 시스템, 이미지 등 모든것에 대해서 보안이 적용될수 있다.
   기본적으로 오픈놀에서는, 
   네트워크 단에서의 Public Subnet과 Private Subnet을 나누어서 사용하고 있으며, Iam Role을 통한 인증, 인가를 관리하고있다.
   또한 Security Group을 통하여 트래픽 제어를 하여 내, 외적으로의 보안에 신경을 쓰고있다.
   ![image](https://d1.awsstatic.com/legal/builders-library/Screenshots/nat-gateway.a0e23921271e8a48f7e71568222d04f7ad77f43a.png)

5. 코드의 문서화
    오픈놀의 인프라는 클라우드 서비스 업체(Cloud Service Provider, CSP)의 시스템 콘솔에 수동으로 들어가 인프라를 직접 설정해야 했다.

    ![image](https://user-images.githubusercontent.com/23617635/150766855-adeae1fa-f0a6-44f8-bbfb-13644e88d047.png)
    이 접근법은 비효율적이고 오류가 잦고 기업 클라우드 환경에서 확장의 문제가 있다.

    ![image](https://user-images.githubusercontent.com/23617635/150768228-8c198a43-68f1-4422-8150-190f8d7d7c2e.png)

    코드형 인프라(Infrastructure as Code, IaC)는 수동 프로세스가 아닌 코드를 통해 인프라를 관리하고 프로비저닝하는 것을 말합니다.
    오픈놀의 모든 인프라 환경을 Code화 하여 인수인계 및 관리가 편하도록 합니다.

    IaC는 구성 사양을 코드화하고 문서화함으로써 구성 관리를 지원하며, 따라서 구성 변경 사항을 문서화하지 않고 임시로 변경하는 일을 막을 수 있습니다.
    
    **기존 프로비저닝 방법에 비해 IaC가 가지는 주요 장점은 다음과 같습니다.**
   - IT 인프라를 신속한 가치 전달을 위한 조력자로 활용할 수 있다. 
   - 인프라 변경에 따르는 리소스 및 위험이 감소한다.  
   - 인프라 사용자가 필요할 때 필요한 리소스를 확보할 수 있다. 
   - 개발 및 운영 전반에 걸쳐 공통의 도구를 제공할 수 있다.  
   - 신뢰할 수 있고, 안정적이며, 비용 효율적인 시스템을 구축할 수 있다.  
   - 거버넌스, 보안, 컴플라이언스 통제를 가시화할 수 있다.  
   - 문제 및 장애 해결 속도가 향상된다. 
   - 인프라의 버전제어가 가능하다.

